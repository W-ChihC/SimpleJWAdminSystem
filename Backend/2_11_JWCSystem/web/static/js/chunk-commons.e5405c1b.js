(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-commons"],{"333d":function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"pagination-container",class:{hidden:e.hidden}},[a("el-pagination",e._b({attrs:{background:e.background,"current-page":e.currentPage,"page-size":e.pageSize,layout:e.layout,"page-sizes":e.pageSizes,total:e.total},on:{"update:currentPage":function(t){e.currentPage=t},"update:current-page":function(t){e.currentPage=t},"update:pageSize":function(t){e.pageSize=t},"update:page-size":function(t){e.pageSize=t},"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}},"el-pagination",e.$attrs,!1))],1)},i=[],l=(a("c5f6"),a("09f4")),o={name:"Pagination",props:{total:{required:!0,type:Number},page:{type:Number,default:1},limit:{type:Number,default:20},pageSizes:{type:Array,default:function(){return[10,20,30,50]}},layout:{type:String,default:"total, sizes, prev, pager, next, jumper"},background:{type:Boolean,default:!0},autoScroll:{type:Boolean,default:!0},hidden:{type:Boolean,default:!1}},computed:{currentPage:{get:function(){return this.page},set:function(e){this.$emit("update:page",e)}},pageSize:{get:function(){return this.limit},set:function(e){this.$emit("update:limit",e)}}},methods:{handleSizeChange:function(e){this.$emit("pagination",{page:this.currentPage,limit:e}),this.autoScroll&&Object(l["a"])(0,800)},handleCurrentChange:function(e){this.$emit("pagination",{page:e,limit:this.pageSize}),this.autoScroll&&Object(l["a"])(0,800)}}},r=o,s=(a("e498"),a("2877")),u=Object(s["a"])(r,n,i,!1,null,"6af373ef",null);t["a"]=u.exports},"674d":function(e,t,a){"use strict";var n=a("b32e"),i=a.n(n);i.a},7456:function(e,t,a){},"9e05":function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"excels"}},[a("upload-excel",{attrs:{"col-map":e.colMap,"upload-api":e.uploadApi}}),e._v(" "),a("export-excel",{staticStyle:{"margin-left":"10px"},attrs:{"col-map":e.colMap,"download-api":e.downloadApi}})],1)},i=[],l=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"upload-excel-container"},[a("input",{ref:"excel-upload-input",attrs:{accept:".xlsx, .xls",hidden:"",type:"file"},on:{change:e.handleClick}}),e._v(" "),a("el-button",{directives:[{name:"waves",rawName:"v-waves"}],attrs:{loading:e.fileLoading,icon:"el-icon-circle-plus",type:"primary"},on:{click:e.handleImport}},[e._v("\n        导入\n    ")]),e._v(" "),a("el-dialog",{attrs:{visible:e.dialogVisible,title:"待上传信息(默认全选)"},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],attrs:{data:e.tableData,border:"",fit:"","highlight-current-row":""},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{align:"center",type:"selection"}}),e._v(" "),e._l(e.colMap,(function(e,t){return a("el-table-column",{key:e,attrs:{label:t,prop:e,align:"center"}})}))],2),e._v(" "),a("pagination",{directives:[{name:"show",rawName:"v-show",value:e.queryPage.total>1,expression:"queryPage.total>1"}],attrs:{limit:e.queryPage.limit,page:e.queryPage.page,total:e.queryPage.total},on:{"update:limit":function(t){return e.$set(e.queryPage,"limit",t)},"update:page":function(t){return e.$set(e.queryPage,"page",t)},pagination:e.getNext}}),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.uploading,expression:"uploading",modifiers:{fullscreen:!0,lock:!0}}],attrs:{type:"primary"},on:{click:e.handleUpload}},[e._v("\n                确认\n            ")])],1)],1)],1)},o=[],r=(a("7f7f"),a("1146")),s=a.n(r),u=a("333d"),c=a("6724"),d={name:"ImportExcelButton",components:{Pagination:u["a"]},directives:{waves:c["a"]},props:{uploadApi:{type:Function,default:function(){return function(e){return console.log("传入",e),new Promise((function(e){e({code:2e4})}))}}},colMap:{default:function(){return{"头像":"avatar","学号":"sno"}}}},data:function(){return{tableData:[],excelData:{header:null,results:null},multipleSelection:null,queryPage:{total:0,limit:20,page:0},fileLoading:!1,dialogVisible:!1,tableLoading:!1,uploading:!1}},methods:{handleImport:function(){this.fileLoading=!0,this.$refs["excel-upload-input"].click()},generateData:function(e){var t=e.header,a=e.results;this.excelData.header=t,this.excelData.results=a,this.onSuccess&&this.onSuccess(this.excelData)},handleClick:function(e){if(!this.dialogVisible){var t=e.target.files,a=t[0];if(a){if(!this.isExcel(a))return this.$message.error("仅支持 .xlsx, .xls, .csv 等格式文件"),this.fileLoading=!1,!1;this.dialogVisible=!0,this.upload(a),this.fileLoading=!1}}},upload:function(e){if(this.$refs["excel-upload-input"].value=null,this.beforeUpload){var t=this.beforeUpload(e);t&&(this.readData(e),this.dialogVisible=!1)}else this.readData(e)},readData:function(e){var t=this;return this.tableLoading=!0,new Promise((function(a,n){var i=new FileReader;i.onload=function(e){var n=e.target.result,i=s.a.read(n,{type:"array"}),l=i.SheetNames[0],o=i.Sheets[l],r=t.getHeaderRow(o),u=s.a.utils.sheet_to_json(o);t.generateData({header:r,results:u}),t.queryPage.total=t.excelData.results.length,t.queryPage.page=0,t.colMapper(),a(),t.tableLoading=!1},i.readAsArrayBuffer(e)}))},getHeaderRow:function(e){var t,a=[],n=s.a.utils.decode_range(e["!ref"]),i=n.s.r;for(t=n.s.c;t<=n.e.c;++t){var l=e[s.a.utils.encode_cell({c:t,r:i})],o="未知 "+t;l&&l.t&&(o=s.a.utils.format_cell(l)),a.push(o)}return a},isExcel:function(e){return/\.(xlsx|xls|csv)$/.test(e.name)},handleSelectionChange:function(e){this.multipleSelection=e},getNext:function(){var e=this.queryPage;e.total=this.excelData.length;var t=page*e.limit;this.tableData=this.excelData.results.slice(t,t+e.limit),++e.page},handleUpload:function(){var e=this;this.uploading=!0,this.uploadApi(this.multipleSelection?this.multipleSelection:this.tableData).then((function(t,a){2e4===t.code?(e.$notify({title:"成功",message:t.message,type:"success"}),e.dialogVisible=!1):e.$notify.error({title:"失败",message:t.message}),e.uploading=!1}))},colMapper:function(){var e=this;this.tableData=this.excelData.results.map((function(t){for(var a in t){var n=e.colMap[a];n&&(t[n]=t[a],delete t[a])}return t}))}}},p=d,g=a("2877"),f=Object(g["a"])(p,l,o,!1,null,null,null),h=f.exports,m=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"download-excel-container"},[a("el-button",{attrs:{loading:e.exportLoading,icon:"el-icon-document",type:"primary"},on:{click:e.handleExport}},[e._v("\n        导出\n    ")])],1)},v=[],x={name:"ExportExcelButton",props:{downloadApi:{type:Function,default:function(){return function(){return console.log("传入"),new Promise((function(e){e({code:2e4,data:{items:[{name:"测试",value:"dsd"},{name:"测试1",value:"dsdggfas"},{name:"测试2",value:"ds323vf2321vfd1d"}],total:3}})}))}}},colMap:{default:function(){return{"姓名":"name","不是道":"value"}}}},data:function(){return{list:null,total:null,dataHeader:[],dataContent:"",exportLoading:!1,filename:"",bookType:"xlsx"}},methods:{handleExport:function(){var e=this;this.exportLoading=!0,this.downloadApi().then((function(t){if(2e4===t.code){e.dataHeader=[],e.dataContent=t.data.items.map((function(t){for(var a in t){var n=void 0,i=e.colMap;for(var l in i)if(i[l]===a){n=l;break}n&&(t[n]=t[a],delete t[a])}return t}));var n=e.colMap;for(var i in n)e.dataHeader.push(i);e.$notify.info({title:"成功",message:"后端数据下载成功,开始准备导出...请稍后"}),e.total=t.data.total,e.filename=(new Date).toLocaleString(),Promise.all([a.e("chunk-23b9c8dc"),a.e("chunk-748b566e")]).then(a.bind(null,"4bf8d")).then((function(t){var a=e.formatJson(e.dataHeader,e.dataContent);t.export_json_to_excel({header:e.dataHeader,data:a,filename:e.filename,autoWidth:!0,bookType:e.bookType}),e.exportLoading=!1,e.$notify({title:"成功",message:"Excel文件已准备完成,开始下载",type:"success"})}))}else e.$notify.error({title:"失败",message:res.message}),e.exportLoading=!1}))},formatJson:function(e,t){return t.map((function(t){return e.map((function(e){return t[e]}))}))}}},b=x,y=Object(g["a"])(b,m,v,!1,null,null,null),w=y.exports,_={name:"ExcelGroup",components:{UploadExcel:h,ExportExcel:w},props:{colMap:{},uploadApi:Function,downloadApi:Function}},S=_,P=(a("674d"),Object(g["a"])(S,n,i,!1,null,null,null));t["a"]=P.exports},b32e:function(e,t,a){},e498:function(e,t,a){"use strict";var n=a("7456"),i=a.n(n);i.a}}]);