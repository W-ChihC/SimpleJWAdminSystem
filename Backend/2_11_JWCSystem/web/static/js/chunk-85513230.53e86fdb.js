(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-85513230"],{"133c":function(t,e,a){"use strict";var r=a("d785"),s=a.n(r);s.a},"263c":function(t,e,a){},"3cbc":function(t,e,a){"use strict";var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"pan-item",style:{zIndex:t.zIndex,height:t.height,width:t.width}},[a("div",{staticClass:"pan-info"},[a("div",{staticClass:"pan-info-roles-container"},[t._t("default")],2)]),t._v(" "),a("div",{staticClass:"pan-thumb",style:{backgroundImage:"url("+t.image+")"}})])},s=[],o=(a("c5f6"),{name:"PanThumb",props:{image:{type:String,required:!0},zIndex:{type:Number,default:1},width:{type:String,default:"150px"},height:{type:String,default:"150px"}}}),n=o,i=(a("133c"),a("2877")),u=Object(i["a"])(n,r,s,!1,null,"799537af",null);e["a"]=u.exports},4690:function(t,e,a){"use strict";var r=a("263c"),s=a.n(r);s.a},"7faf":function(t,e,a){"use strict";var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-card",{staticStyle:{"margin-bottom":"20px"}},[t.noHeader?t._e():a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[t._v("个人信息")])]),t._v(" "),a("div",{staticClass:"user-profile"},[a("div",{staticClass:"box-center"},[a("pan-thumb",{attrs:{height:"100px",hoverable:!1,image:t.user.avatar,width:"100px"}},[a("small",[t._v("用户组")]),t._v(" "),a("br"),a("br"),t._v("\n        "+t._s(t.user.role)+"\n      ")])],1),t._v(" "),a("div",{staticClass:"box-center"},[a("div",{staticClass:"user-name text-center"},[t._v(t._s(t.user.name))]),t._v(" "),a("div",{staticClass:"user-role text-center text-muted"},[t._v(t._s(t._f("uppercaseFirst")(t.user.role)))])])]),t._v(" "),a("div",{staticClass:"user-bio"},[a("div",{staticClass:"user-education user-bio-section"},[a("div",{staticClass:"user-bio-section-header"}),t._v(" "),a("div",{staticClass:"user-bio-section-body"},[t.noAlert?t._e():a("el-alert",{attrs:{type:"warning",description:"修改信息,成功后将会要求重新登录"}})],1)])])])},s=[],o=a("3cbc"),n={components:{PanThumb:o["a"]},props:{user:{type:Object,default:function(){return{name:"",email:"",avatar:"",roles:""}}},noAlert:!1,noHeader:!1}},i=n,u=(a("4690"),a("2877")),c=Object(u["a"])(i,r,s,!1,null,"cd4a7184",null);e["a"]=c.exports},"95c8":function(t,e,a){"use strict";a.d(e,"b",(function(){return o})),a.d(e,"c",(function(){return n})),a.d(e,"a",(function(){return i}));var r=a("b775"),s=function(t){return"/admin/"+t};function o(t){return Object(r["a"])({url:s("update/admin"),method:"post",data:t})}function n(t){return Object(r["a"])({url:s("update/adminPassword"),method:"post",data:t})}function i(){return Object(r["a"])({url:s("home"),method:"get"})}},d785:function(t,e,a){},ecac:function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"app-container"},[t.user?a("div",[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:6,xs:24}},[a("user-card",{attrs:{user:t.user}})],1),t._v(" "),a("el-col",{attrs:{span:18,xs:24}},[a("el-card",[a("el-tabs",{model:{value:t.activeTab,callback:function(e){t.activeTab=e},expression:"activeTab"}},[a("el-tab-pane",{attrs:{label:"修改信息",name:"account"}},[a("account",{attrs:{role:t.rolesInfo[t.userInfo.roles[0]],user:t.user},on:{"update:role":function(e){return t.$set(t.rolesInfo,t.userInfo.roles[0],e)}}})],1),t._v(" "),a("el-tab-pane",{attrs:{label:"修改密码",name:"password"}},[a("password",{attrs:{role:t.rolesInfo[t.userInfo.roles[0]]},on:{"update:role":function(e){return t.$set(t.rolesInfo,t.userInfo.roles[0],e)}}})],1)],1)],1)],1)],1)],1):t._e()])},s=[],o=(a("ac6a"),a("96cf"),a("3b8d")),n=(a("7f7f"),a("db72")),i=a("2f62"),u=a("7faf"),c=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-form",{ref:"form1",attrs:{model:t.role.formData,rules:t.rules}},[t._l(t.role.formHeader,(function(e,r){return a("el-form-item",{key:r,staticStyle:{width:"50vh"},attrs:{label:e,prop:r}},["avatar"===r?a("el-form-item",{attrs:{prop:"avatar"}},[a("el-upload",{staticClass:"avatar-uploader",attrs:{headers:t.headers,"on-change":t.handleAvatarSelected,"on-success":t.handleAvatarUploaded,"show-file-list":!1,action:"api/common/putImg","auto-upload":""}},[a("el-avatar",{attrs:{size:120,src:t.avatarUrl,fit:"contain",shape:"circle"}})],1)],1):a("el-input",{model:{value:t.role.formData[r],callback:function(e){t.$set(t.role.formData,r,e)},expression:"role.formData[key]"}})],1)})),t._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:t.submit}},[t._v("保存修改")])],1)],2)},l=[],d=a("5f87"),f={props:{role:{}},computed:{headers:function(){return{"X-Token":Object(d["a"])()}}},data:function(){return{avatarUrl:"",rules:{name:[{required:!0,message:"请填写用户名"}],email:[{type:"email",message:"请输入正确的邮箱地址"}]}}},created:function(){this.avatarUrl=this.role.formData.avatar},methods:{submit:function(){var t=this;this.$refs["form1"].validate((function(e){e?t.role.onSubmit():t.$notify({title:"警告",message:"请按提示将数据填写正确",type:"warning",duration:2e3})}))},handleAvatarSelected:function(t,e){var a=null;void 0!==window.createObjectURL?a=window.createObjectURL(e[0].raw):void 0!==window.webkitURL?a=window.webkitURL.createObjectURL(e[0].raw):void 0!==window.URL&&(a=window.URL.createObjectURL(e[0].raw)),this.avatarUrl=a},handleAvatarUploaded:function(t){2e4===t.code&&(this.role.formData.avatar=t.url)}}},m=f,h=a("2877"),p=Object(h["a"])(m,c,l,!1,null,null,null),v=p.exports,w=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-form",{ref:"form2",attrs:{model:t.form,rules:t.rules}},[a("el-form-item",{staticStyle:{width:"50vh"},attrs:{label:"旧密码",prop:"oldPassword"}},[a("el-input",{attrs:{clearable:"","show-password":"",type:"password"},model:{value:t.form.oldPassword,callback:function(e){t.$set(t.form,"oldPassword",e)},expression:"form.oldPassword"}})],1),t._v(" "),a("el-form-item",{staticStyle:{width:"50vh"},attrs:{label:"新密码",prop:"newPassword"}},[a("el-input",{attrs:{clearable:"","show-password":"",type:"password"},model:{value:t.form.newPassword,callback:function(e){t.$set(t.form,"newPassword",e)},expression:"form.newPassword"}})],1),t._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:t.submit}},[t._v("保存修改")])],1)],1)},b=[],g={props:{role:{}},data:function(){return{form:{oldPassword:" ",newPassword:""},rules:{oldPassword:[{required:!0,message:"请填写旧密码"}],newPassword:[{required:!0,message:"新密码不能为空"}]}}},methods:{submit:function(){var t=this;this.$refs["form2"].validate((function(e){e?t.role.onSetPassword(t.form.newPassword,t.form.oldPassword):t.$notify({title:"提示",message:"请按提示将数据填写正确",type:"warning",duration:2e3})}))}}},_=g,P=Object(h["a"])(_,w,b,!1,null,null,null),y=P.exports,x=a("95c8"),j=a("b775"),O=function(t){return"/student/"+t};function I(t){return Object(j["a"])({url:O("update/student"),method:"post",data:t})}function T(t){return Object(j["a"])({url:O("update/studentPassword"),method:"post",data:t})}var $=function(t){return"/teacher/"+t};function C(t){return Object(j["a"])({url:$("update/teacher"),method:"post",data:t})}function S(t){return Object(j["a"])({url:$("update/teacherPassword"),method:"post",data:t})}var U={name:"Profile",computed:Object(n["a"])({},Object(i["b"])(["name","avatar","roles","userInfo"])),components:{Password:y,UserCard:u["a"],Account:v},data:function(){var t,e;return{user:{},activeTab:"account",rolesInfo:{student:{that:null,formHeader:{avatar:"头像",name:"姓名",sex:"性别",age:"年龄",jiguan:"籍贯",email:"电子邮箱",phone:"手机号码"},formData:{},onSubmit:function(){var t=this;I(this.formData).then((function(e){2e4===e.code&&(t.that.showToast("success",e.message),setTimeout((function(){return t.that.logout()}),2e3))}))},onSetPassword:function(t,e){var a=this;T({id:this.formData.id,oldPassword:e,newPassword:t}).then((function(t){2e4===t.code&&(a.that.showToast("success",t.message),setTimeout((function(){return a.that.logout()}),2e3))}))}},admin:{that:null,formHeader:{name:"用户名"},formData:{id:null===(t=this.userInfo)||void 0===t?void 0:t.id,name:null===(e=this.userInfo)||void 0===e?void 0:e.name},onSubmit:function(){var t=this;Object(x["b"])(this.formData).then((function(e){2e4===e.code&&(t.that.showToast("success",e.message),setTimeout((function(){return t.that.logout()}),2e3))}))},onSetPassword:function(t,e){var a=this;Object(x["c"])({id:this.formData.id,oldPassword:e,newPassword:t}).then((function(t){2e4===t.code&&(a.that.showToast("success",t.message),setTimeout((function(){return a.that.logout()}),2e3))}))}},teacher:{that:null,formHeader:{avatar:"头像",name:"姓名",sex:"性别",age:"年龄",email:"电子邮箱",phone:"手机号码"},formData:{},onSubmit:function(){var t=this;C(this.formData).then((function(e){2e4===e.code&&(t.that.showToast("success",e.message),setTimeout((function(){return t.that.logout()}),2e3))}))},onSetPassword:function(t,e){var a=this;S({id:this.formData.id,oldPassword:e,newPassword:t}).then((function(t){2e4===t.code&&(a.that.showToast("success",t.message),setTimeout((function(){return a.that.logout()}),2e3))}))}}}}},created:function(){this.getUser()},methods:{showToast:function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;1===a?this.$notify({title:"提示",message:e,type:t,duration:2e3}):this.$message({message:e,type:t})},logout:function(){var t=Object(o["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$store.dispatch("user/logout");case 2:this.$router.push("/login?redirect=".concat(this.$route.fullPath));case 3:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),matchRoleName:function(t){var e={admin:"管理员",student:"学生",teacher:"教师"},a=Object.assign([],t);return a.forEach((function(t,r){a[r]=e[t]})),a},getUser:function(){this.user={name:this.userInfo.name,role:this.matchRoleName(this.roles).join(" | "),avatar:this.userInfo.avatar};var t=this.rolesInfo[this.roles[0]];t.that=this,t.formData=this.userInfo}}},k=U,D=Object(h["a"])(k,r,s,!1,null,null,null);e["default"]=D.exports}}]);